@using PersonnelManagement.Entities.Concrete
@using PersonnelManagement.Entities.DTOs;
@using PersonnelManagement.Mvc
@using PersonnelManagement.Mvc.Models
@model dynamic

<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Your page title</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/free-jqgrid/4.15.5/css/ui.jqgrid.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/themes/redmond/jquery-ui.min.css">

    <style>

#jqGrid2 .ui-jqgrid tr.jqgrow {
    
    border-color: transparent !important;
}

#jqGrid2 .ui-jqgrid td {
    background-color: transparent !important;
}

#jqGrid2 .ui-jqgrid tr.jqgrow:hover {
    background-color: transparent !important;
}

#jqGrid2 .ui-jqgrid tr.jqgrow td {
    background-color: transparent !important;
}

#jqGrid2 .ui-jqgrid tr.jqgrow.ui-state-highlight {
    background-color: transparent !important;
    border-color: transparent !important;
}

#jqGrid2 .ui-jqgrid tr.jqgrow.ui-state-highlight:hover {
    background-color: transparent !important;
}

#jqGrid2 .ui-widget-content,
       #jqGrid2 #grid tr:hover{  
            background:none;
            border:none;
            color:white;
             text-shadow: 2px 2px 5px black;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>var $ = jQuery.noConflict(false);</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/free-jqgrid/4.15.5/jquery.jqgrid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.all.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js'></script>
    <script src='https://unpkg.com/tooltip.js/dist/umd/tooltip.min.js'></script>
     <script>
    $(function() {
      var allGrids = $("table[id^='jqGrid']");

      allGrids.each(function() {
        var grid = $(this);
        grid.on("gridComplete", function() {
          var rows = grid.jqGrid('getDataIDs');
          for (var i = 0; i < rows.length; i++) {
            var rowData = grid.jqGrid('getRowData', rows[i]);
            var color = rowData.Color;
            $('#' + rows[i]).css('background-color', color);
          }
        });
      });
    });
  </script>

    <script>

  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var today = new Date();
    var day = today.getDate();
    var month = today.getMonth() + 1;
    var year = today.getFullYear();
    if (day < 10) {
        day = '0' + day;
    }
    if (month < 10) {
        month = '0' + month;
    }
    var formattedDate = year + '-' + month + '-' + day;
    var calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      initialDate: formattedDate,
      locale: "tr",
      themeSystem: "bootstrap",
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectMirror: true,
      eventDisplay: "block",
      select: function(arg) {
          $.ajax({
                url: "/Schedule",
                type: "GET",
                success: function (result) {
                    $("#addScheduleShiftModal.modal-content").html(result);
                    document.getElementById("addScheduleShiftModal").style.display = "block";
                }
          });
          document.getElementById("inputtedStartDate").value = arg.startStr;
          document.getElementById("inputtedEndDate").value = arg.endStr;
        //var title = prompt('Event Title:');
        //if (title) {
        //  calendar.addEvent({
        //    title: title,
        //    start: arg.start,
        //    end: arg.end,
        //    allDay: arg.allDay
        //  })
        //}
        calendar.unselect()
      },
      eventClick: function(arg) {
          var eventId = arg.event.id
          var modifiedByName = "clicker"
          Swal.fire({
            title: 'Hangi işlemi Yapmak istersiniz?',
            showDenyButton: true,
            showCancelButton: true,
            confirmButtonText: 'Show Details',
            denyButtonText: 'Delete',
            customClass: {
                actions: 'my-actions',
                cancelButton: 'order-1 right-gap',
                confirmButton: 'order-2',
                denyButton: 'order-3',
            }
          }).then((result) => {
          if (result.isConfirmed) {///////////////////////////////////////////////////Update
              var detailTitle = arg.event._def.extendedProps.description;
              var detailOwner = arg.event._def.title;
              var detailStart = moment(arg.event.start).format('DD/MM/yyyy');
              var detailEnd = moment(arg.event.end).format('DD/MM/yyyy');
              debugger;
              Swal.fire({
                title: '<strong style="font-size: 25px;">'+ detailOwner +'</strong>',
                icon: 'question',
                html:
                '<b>Start Date: </b> ' + detailStart +
                '<br/><b>End Date: </b> ' + detailEnd +
                '<br/><b>Hours: </b>' + detailTitle,
                showCloseButton: false,
                showCancelButton: false,
                focusConfirm: false,
                confirmButtonText:
                '<i class="fa fa-thumbs-up"></i> Great!',
                confirmButtonAriaLabel: 'Thumbs up, great!',
                cancelButtonText:
                '<i class="fa fa-thumbs-down"></i>',
                cancelButtonAriaLabel: 'Thumbs down'
              })
          } else if (result.isDenied) {//////////////////////////////////////////////Delete
              var DeleteScheduleShiftData = {
                    ScheduleShiftId : eventId,
                    ModifiedByName: modifiedByName

              }

                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {

                        $.ajax({
                            type: "POST",
                            url: "/Schedule/DeleteScheduleShift",
                            data: DeleteScheduleShiftData,
                            success: function(data) {
                                Swal.fire(
                                    'Deleted!',
                                    'Your choose has been deleted.',
                                    'success'
                                )
                                onNeedReload();
                            },
                            error: function(error) {
                                Swal.fire(
                                    'Error!',
                                    'Deleting failed.',
                                    'error'
                                )
                            }
                        });



                    }
                })
              //Swal.fire('Deleted', '', 'success')
          }
})
      },
      editable: true,
      dayMaxEvents: true, // allow "more" link when too many events
      eventDidMount: function (info) {
          var detailTitle = info.event._def.extendedProps.description;
          var detailOwner = info.event._def.title
            $(info.el).popover({
                title: detailTitle,
                placement: 'top',
                trigger: 'hover',
                content: detailOwner,
                container: 'body'
            });
      },
      eventRender: function(info) {
      //  var tooltip = new Tooltip(info.el, {
      //      title: info.event.extendedProps.description,
      //      placement: 'top',
      //      trigger: 'click',
      //      container: 'body'
      //  });
      },
      events: "/Schedule/GetCalendarDatas/"
    });

    calendar.render();
  });

</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

  .popper,
.tooltip {
  position: absolute;
  z-index: 9999;
  background: #FFC107;
  color: black;
  width: 150px;
  border-radius: 3px;
  box-shadow: 0 0 2px rgba(0,0,0,0.5);
  padding: 10px;
  text-align: center;
}
.style5 .tooltip {
  background: #1E252B;
  color: #FFFFFF;
  max-width: 200px;
  width: auto;
  font-size: .8rem;
  padding: .5em 1em;
}
.popper .popper__arrow,
.tooltip .tooltip-arrow {
  width: 0;
  height: 0;
  border-style: solid;
  position: absolute;
  margin: 5px;
}

.tooltip .tooltip-arrow,
.popper .popper__arrow {
  border-color: #FFC107;
}
.style5 .tooltip .tooltip-arrow {
  border-color: #1E252B;
}
.popper[x-placement^="top"],
.tooltip[x-placement^="top"] {
  margin-bottom: 5px;
}
.popper[x-placement^="top"] .popper__arrow,
.tooltip[x-placement^="top"] .tooltip-arrow {
  border-width: 5px 5px 0 5px;
  border-left-color: transparent;
  border-right-color: transparent;
  border-bottom-color: transparent;
  bottom: -5px;
  left: calc(50% - 5px);
  margin-top: 0;
  margin-bottom: 0;
}
.popper[x-placement^="bottom"],
.tooltip[x-placement^="bottom"] {
  margin-top: 5px;
}
.tooltip[x-placement^="bottom"] .tooltip-arrow,
.popper[x-placement^="bottom"] .popper__arrow {
  border-width: 0 5px 5px 5px;
  border-left-color: transparent;
  border-right-color: transparent;
  border-top-color: transparent;
  top: -5px;
  left: calc(50% - 5px);
  margin-top: 0;
  margin-bottom: 0;
}
.tooltip[x-placement^="right"],
.popper[x-placement^="right"] {
  margin-left: 5px;
}
.popper[x-placement^="right"] .popper__arrow,
.tooltip[x-placement^="right"] .tooltip-arrow {
  border-width: 5px 5px 5px 0;
  border-left-color: transparent;
  border-top-color: transparent;
  border-bottom-color: transparent;
  left: -5px;
  top: calc(50% - 5px);
  margin-left: 0;
  margin-right: 0;
}
.popper[x-placement^="left"],
.tooltip[x-placement^="left"] {
  margin-right: 5px;
}
.popper[x-placement^="left"] .popper__arrow,
.tooltip[x-placement^="left"] .tooltip-arrow {
  border-width: 5px 0 5px 5px;
  border-top-color: transparent;
  border-right-color: transparent;
  border-bottom-color: transparent;
  right: -5px;
  top: calc(50% - 5px);
  margin-left: 0;
  margin-right: 0;
}

.my-actions { margin: 0 2em; }
.order-1 { order: 1; }
.order-2 { order: 2; }
.order-3 { order: 3; }

.right-gap {
  margin-right: auto;
}
</style>

<style>
        .ui-jqgrid {
            background-color: transparent !important;
        }
    </style>
</head>
<body>
    
    <div id = "addShiftTypeModal" class="modal" style="display:none">
        <div class="modal-content">
            @Html.Partial("_AddShiftTypePartial")
        </div>
    </div>

    <div id = "updateShiftTypeModal" class="modal" style="display:none">
        <div class="modal-content">
            @Html.Partial("_UpdateShiftTypePartial")
        </div>
    </div>

    <div id = "addScheduleShiftModal" class="modal" style="display:none">
        <div class="modal-content">
            @Html.Partial("_AddScheduleShiftPartial")
        </div>
    </div>
  <div class="container">
      <div id='calendar'></div>
  </div>
@*  <table>
      <tr>
          <th>Vardiya Tipleri</th>
      </tr>
        @foreach (var item in Model.shiftTypes)
        {
                                        <tr><td style="background-color:@item.Color; color:white"><span>&#8594;</span> @item.StartTime.ToString("hh\\:mm") - @item.EndTime.ToString("hh\\:mm") ~ @item.ShiftTypeName </td></tr>
        }
  </table>
 *@

    <table id="jqGrid2" ></table>
        <div id="jqGridPager" style="width:100%; height:auto; margin: auto;"></div>    <button id ="addNewButton" onclick="onClickNewAdd()">Add New</button>
                          
</body>
<script type="text/javascript">

    var grid2 = $("#jqGrid2");
    var selectedStRowId = -1;
    var row;
    var rowId;
    var rowName;
    var rowSTime;
    var rowETime;
    var rowColor;

    function onNeedReload(){
                debugger;
                grid2.setGridParam({ datatype: 'json' });
                debugger;
                var pageCount = grid2.getGridParam("lastpage");
                for (let i = 0; i < pageCount; i++) {
                        grid2.trigger("reloadGrid", [{page: i, current: true}]);
                }


        }

    $(document).ready(function () {
        debugger;
    grid2.jqGrid({
        url: "Schedule/GetShiftTypes",
        datatype: "json",
        colModel: [
            { label: "Id", name: "ShiftTypeId", key: true, width:25},
            { label: "Vardiya Adı", name: "ShiftTypeName", width: 80 },
            { label: "Başlangıç Saati", name: "StartTime", width: 50 },
            { label: "Bitiş Saati", name: "EndTime", width: 50 },
            { label: "Renk Kodu", name: "Color", width:30},
            {
                        name: 'Settings',
                        index: 'Settings',
                        width: "40%",
                        align: 'center',
                        sortable: false,
                        formatter: function(cellvalue, options, rowObject) {
                            return '<button class="StEdit_btn" >Edit</button>&nbsp;&nbsp;&nbsp;' + 
                                    '<button href="#" class="StDel_btn" >Delete</button>';
                        }
                    }
        ],
        width: '800',
        height:'auto',
        rowNum: 20,
        pager: false,//"#jqGridPager",
        loadonce:true,
        gridComplete: function() {
            var rows = grid2.jqGrid('getDataIDs');
            for (var i = 0; i < rows.length; i++) {
                var rowData = grid2.jqGrid('getRowData', rows[i]);
                var color = rowData.Color;
                 $('#gbox_' + grid2.attr('id') + ' #' + rows[i]).css('background-color', color);
            }
        }
    });
});



       $(document).on('click', '.StEdit_btn', function () {

                    var row = $(this).closest('tr.jqgrow');
                    selectedStRowId = row.attr('id');
                    var rowId = selectedStRowId
                    var rowName = row.find('td:eq(1)').text();
                    var rowSTime = row.find('td:eq(2)').text();
                    var rowETime = row.find('td:eq(3)').text();
                    var rowColor = row.find('td:eq(4)').text();
                    debugger;
                    if(selectedStRowId != -1){
                debugger;
                $.ajax({
                url: "/Schedule",
                type: "GET",
                success: function (result) {
                    var myModel = @Html.Raw(Json.Serialize(Model));
                    debugger;
                    currentId = rowId;
                    var modifiedByName = "mvcDefault"; //şimdilik

                    document.getElementById("updatedShiftType").value = rowName;
                    document.getElementById("updatedStartTime").value = rowSTime;
                    document.getElementById("updatedEndTime").value = rowETime;
                    document.getElementById("updatedColor").value = rowColor;
                    debugger;
                    $("#updateShiftTypeModal.modal-content").html(result);
                    document.getElementById("updateShiftTypeModal").style.display = "block";
                }
            });
            }
       });

       $(document).on('click', '.StDel_btn', function () {
                debugger;
                var row = $(this).closest('tr.jqgrow');
                var rowId = row.attr('id');
                
                debugger;

                var modifiedByName = "mvcDefault" //şimdilik

                
                var DeleteShiftData = {
                    ShiftTypeId : rowId,
                    ModifiedByName: modifiedByName

                }
                document.getElementById("updateShiftTypeModal").style.display = "none";

                Swal.fire({
                    title: 'Are you sure?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, delete it!'
                }).then((result) => {
                    if (result.isConfirmed) {

                        $.ajax({
                            type: "POST",
                            url: "/Schedule/DeleteShiftType",
                            data: DeleteShiftData,
                            success: function(data) {
                                Swal.fire(
                                    'Deleted!',
                                    'Your choose has been deleted.',
                                    'success'
                                )
                                onNeedReload();
                            },
                            error: function(error) {
                                Swal.fire(
                                    'Error!',
                                    'Deleting failed.',
                                    'error'
                                )
                            }
                        });



                    }
                })
                debugger;
        });
    $(document).ready(function() {

        var isSpecial = false;
        onClickNewAdd = function() {
            $.ajax({
                url: "/Schedule",
                type: "GET",
                success: function (result) {
                    $("#addShiftTypeModal.modal-content").html(result);
                    document.getElementById("addShiftTypeModal").style.display = "block";
                }
            });
        }

        onClickSave = function(){
            debugger;
                var inputtedShiftType = $('#inputtedShiftType').val()
                var newStartTime = $('#inputtedStartTime').val()
                var newEndTime = $('#inputtedEndTime').val()
                var newColor =  $('#inputtedColor').val()
                debugger;
                var NewShiftData = {
                        InputtedShiftType : inputtedShiftType,
                        StartTime : newStartTime,
                        EndTime : newEndTime,
                        Color : newColor,

                }
                debugger;
                    $.ajax({
                        type: "POST",
                        url: "/Schedule/AddShiftType",
                        data: NewShiftData,
                        success: function(data) {
                            onNeedReload();
                            document.getElementById("addShiftTypeModal").style.display = "none";
                        },
                        error: function(error) {
                        console.log(error);
                        }
                    });

                    debugger;
        }



        onClickUpdate = function(){
            debugger;
                var inputtedShiftType = $('#updatedShiftType').val()
                var newStartTime = $('#updatedStartTime').val()
                var newEndTime = $('#updatedEndTime').val()
                var newColor =  $('#updatedColor').val()
                debugger;
                var UpdatedShiftData = {
                    ShiftTypeId : selectedStRowId,
                    InputtedShiftType : inputtedShiftType,
                    StartTime : newStartTime,
                    EndTime : newEndTime,
                    Color : newColor,

                }
                document.getElementById("updateShiftTypeModal").style.display = "none";

                Swal.fire({
                    title: 'Are you sure about that?',
                    text: "You won't be able to revert this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, update it!'
                }).then((result) => {
                    if (result.isConfirmed){
                        $.ajax({
                        type: "POST",
                        url: "/Schedule/UpdateShiftType",
                        data: UpdatedShiftData,
                        success: function(data) {
                            Swal.fire(
                                    'Updated!',
                                    'Your choose has been deleted.',
                                    'success'
                            )
                            onNeedReload();

                        },
                            error: function(error) {
                                Swal.fire(
                                    'Error!',
                                    'Deleting failed.',
                                    'error'
                                )
                            }
                        });
                    }
                });
        }
        
    });
</script>
</html>
