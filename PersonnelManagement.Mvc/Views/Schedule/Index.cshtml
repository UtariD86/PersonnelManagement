@using PersonnelManagement.Entities.Concrete
@using PersonnelManagement.Entities.DTOs;
@using PersonnelManagement.Mvc
@using PersonnelManagement.Mvc.Models
@model dynamic

<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Your page title</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/free-jqgrid/4.15.5/css/ui.jqgrid.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/themes/redmond/jquery-ui.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>var $ = jQuery.noConflict(false);</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/free-jqgrid/4.15.5/jquery.jqgrid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.2/dist/sweetalert2.all.min.js"></script>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.4/index.global.min.js'></script>
    
    <script>

  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var today = new Date();
    var day = today.getDate();
    var month = today.getMonth() + 1;
    var year = today.getFullYear();
    if (day < 10) {
        day = '0' + day;
    }
    if (month < 10) {
        month = '0' + month;
    }
    var formattedDate = year + '-' + month + '-' + day;
    var calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay'
      },
      initialDate: formattedDate,
      locale: "tr",
      themeSystem: "bootstrap",
      navLinks: true, // can click day/week names to navigate views
      selectable: true,
      selectMirror: true,
      select: function(arg) {
        var title = prompt('Event Title:');
        if (title) {
          calendar.addEvent({
            title: title,
            start: arg.start,
            end: arg.end,
            allDay: arg.allDay
          })
        }
        calendar.unselect()
      },
      eventClick: function(arg) {
        if (confirm('Are you sure you want to delete this event?')) {
          arg.event.remove()
        }
      },
      editable: true,
      dayMaxEvents: true, // allow "more" link when too many events
      events: [
        {
          title: 'All Day Event',
          start: '2023-01-01'
        },
        {
          title: 'Long Event',
          start: '2023-01-07',
          end: '2023-01-10'
        },
        {
          groupId: 999,
          title: 'Repeating Event',
          start: '2023-01-09T16:00:00'
        },
        {
          groupId: 999,
          title: 'Repeating Event',
          start: '2023-01-16T16:00:00'
        },
        {
          title: 'Conference',
          start: '2023-01-11',
          end: '2023-01-13'
        },
        {
          title: 'Meeting',
          start: '2023-01-12T10:30:00',
          end: '2023-01-12T12:30:00'
        },
        {
          title: 'Lunch',
          start: '2023-01-12T12:00:00'
        },
        {
          title: 'Meeting',
          start: '2023-01-12T14:30:00'
        },
        {
          title: 'Happy Hour',
          start: '2023-01-12T17:30:00'
        },
        {
          title: 'Dinner',
          start: '2023-01-12T20:00:00'
        },
        {
          title: 'Birthday Party',
          start: '2023-01-13T07:00:00'
        },
        {
          title: 'Click for Google',
          url: 'http://google.com/',
          start: '2023-01-28'
        }
      ]
    });

    calendar.render();
  });

</script>
<style>

  body {
    margin: 40px 10px;
    padding: 0;
    font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
    font-size: 14px;
  }

  #calendar {
    max-width: 1100px;
    margin: 0 auto;
  }

</style>
</head>
<body>
    
    <div id = "addShiftTypeModal" class="modal" style="display:none">
        <div class="modal-content">
            @Html.Partial("_AddShiftTypePartial")
        </div>
    </div>

  <div class="container">
      <div id='calendar'></div>
  </div>
  <table>
      <tr>
          <th>Vardiya Tipleri</th>
      </tr>
        @foreach (var item in Model.shiftTypes)
        {
                                        <tr><td style="background-color:@item.Color; color:white"><span>&#8594;</span> @item.StartTime.ToString("hh\\:mm") - @item.EndTime.ToString("hh\\:mm") ~ @item.ShiftTypeName </td></tr>
        }
  </table>
  <button id ="addNewButton" onclick="onClickNewAdd()">Add New</button>
                          <button id ="updateButton" >Update</button>
</body>
<script type="text/javascript">
    $(document).ready(function() {
        onClickNewAdd = function() {
            $.ajax({
                url: "/Schedule",
                type: "GET",
                success: function (result) {
                    $("#addShiftTypeModal.modal-content").html(result);
                    document.getElementById("addShiftTypeModal").style.display = "block";
                }
            });
        }

        onClickSave = function(){
                var newShiftType = $('#inputtedShiftType').val()
                var inputtedStartTime = $('#inputtedStartTime').val()
                var inputtedEndTime = $('#inputtedEndTime').val()

                var startTime = moment(inputtedStartTime, 'HH:mm').format('HH:mm:ss');
                var endTime = moment(inputtedEndTime, 'HH:mm').format('HH:mm:ss');
                var inputtedColor = $('#inputtedColor').val()

                debugger;
                        var shiftTypeData = {
                            InputtedShiftType: newShiftType,
                            StartTime: startTime,
                            EndTime: endTime,
                            Color: inputtedColor,
                        }
                    debugger;
                    $.ajax({
                        type: "POST",
                        url: "/Schedule/AddShiftType",
                        data: shiftTypeData,
                        success: function(data) {

                            document.getElementById("addShiftTypeModal").style.display = "none";
                            $('#inputtedShiftType').val('')
                            $('#inputtedStartTime').val('')
                            $('#inputtedEndTime').val('')
                        },
                        error: function(error) {
                        console.log(error);
                        }
                    });
            }
    });
</script>
</html>
